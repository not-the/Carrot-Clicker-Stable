function menuOpen(){return menuState.dialog||menuState.character||menuState.theme||menuState.cosmetic||menuState.prestige||menuState.tips||menuState.credits}function updateTipsInput(e){e=e.srcElement.value;elFunTipsSlider.value=e,elFunTipsSlider_label.value=e,settings.fun_tip_percentage=parseInt(elFunTipsSlider.value),saveSettings()}function setting(e,t=!1){var a=dom(e).checked;console.log(e+" set to "+a),settings[e]=a,saveSettings(),"compact_achievements"===e?achieveCompactMode(a):"achievements_grid"===e?achieveGridMode(a):"full_numbers"===e?(carrotCount(),updateCPC(),characterPrices()):"show_nav"===e&&style(elBody,"hide_nav",!a),t&&toast("Settings",`${capitalizeFL(e.split("_").join(" "))} ${"s"===e[e.length-1]?"are":"is"} now `+(a?"enabled":"disabled"),"",!1,!0)}elFunTipsSlider.oninput=updateTipsInput,elFunTipsSlider_label.onchange=updateTipsInput;const elNotificationLength=dom("notificationLength"),elNotificationLength_label=dom("notificationLength_label");function optionNotificationLength(e){e=parseInt(e.srcElement.value);elNotificationLength.value=elNotificationLength_label.value=e,settings.notificationLength=e,saveSettings()}function settingAutosave(e){e=e.srcElement.value;dom("autosave_interval").value=e,dom("autosave_interval_label").value=e,settings.autosave_interval=e,saveSettings(),clearInterval(autosave),autosave=setInterval(()=>{saveGame()},1e3*e)}function settingMainProgress(){var e=elEnableMainProgress.checked;console.log("enableMainProgress set to "+e),toast("Settings","Status bar progress is now "+(e?"enabled":"disabled"),"",!1,!0),settings.enableMainProgress=e,saveSettings(),elMainProgressContainer.classList.remove("status_tidbit_in")}function settingSounds(e=!0){var t=elEnableSounds.checked;console.log("enableSounds set to "+t),settings.enableSounds=t,saveSettings(),optionSoundsDisable(t),settingMusic(!0),!0===e&&toast("Settings","Sounds are now "+(t?"enabled":"disabled"),"",!1,!0)}function settingMusic(e=!1){var t=elEnableMusic.checked;return console.log("enableMusic set to "+t),e||toast("Settings","Music is now "+(t?"enabled":"disabled"),"",!1,!0),settings.enableMusic=t,saveSettings(),(t?playMusic:stopMusic)()}function settingCarrotSounds(){var e=elEnableCarrotSounds.checked;console.log("enableCarrotSounds set to "+e),toast("Settings","Carrot sounds are now "+(e?"enabled":"disabled"),"",!1,!0),settings.enableCarrotSounds=e,saveSettings()}elNotificationLength.addEventListener("change",optionNotificationLength),elNotificationLength_label.addEventListener("change",optionNotificationLength),dom("autosave_interval").addEventListener("change",settingAutosave),dom("autosave_interval_label").addEventListener("change",settingAutosave),elVolumeMaster.oninput=volumeSliderHandler,volumeMasterDropdown.oninput=volumeSliderHandler,elVolumeMaster_label.onchange=volumeSliderHandler;var keyCarrotFiring=!1,keyCombo=(document.addEventListener("keydown",e=>{var t=e.key;" "===t&&e.preventDefault(),t=interpretKey(t),!settings.enable_keybinds||menuOpen()||t!==settings.keybinds.key_carrot||keyCarrotFiring||(keyCarrotFiring=!0,holdStart(!1,1))}),document.addEventListener("keyup",e=>{if("Enter"===e.key)return"SUMMARY"!==document.activeElement.tagName?document.activeElement.click():void 0;"Escape"===e.key&&(-1!==equipWaiting?cancelToolEquip():menuOpen()?closeDialog():document.activeElement!==elInfoDropdown?elInfoDropdown.focus():elInfoDropdown.blur()),menuState.prestige&&"Enter"===e.key&&openDialog(...dialog.prestige_confirm);if(!e.ctrlKey&&!e.metaKey){var t,a=interpretKey(e.key);if(keyWaiting[0])return doneKeybind(a,!0);keyCombo+=a+" ",keyCodes.includes(keyCombo)&&(t=keyCodes.indexOf(keyCombo),console.log(`keyComboHandler(${t})`),keyCombo="",keyTrigger[t]=!0,keyCodesCode[t]());for(combo of keyCombo)for(code of keyCodes)if(combo===code){keyCombo="";break}if(settings.enable_keybinds&&!menuState.dialog&&"TEXTAREA"!==document.activeElement.nodeName&&"INPUT"!==document.activeElement.nodeName&&!menuOpen()){if(a===settings.keybinds.key_multibuy&&multibuySpin(),a===settings.keybinds.key_carrot)carrotClick(!1,!1,1),keyCarrotFiring=!1,holdStop(),"Spacebar"===a&&e.preventDefault();else if(a===settings.keybinds.key_bill_lvlup)-1!==equipWaiting?(equipTool(Boomer_Bill,equipWaiting,multibuy[mbsel]),cancelToolEquip()):levelUp(Boomer_Bill,multibuy[mbsel]);else if(a===settings.keybinds.key_belle_lvlup)-1!==equipWaiting?(equipTool(Belle_Boomerette,equipWaiting,multibuy[mbsel]),cancelToolEquip()):levelUp(Belle_Boomerette,multibuy[mbsel]);else if(a===settings.keybinds.key_greg_lvlup)-1!==equipWaiting?(equipTool(Gregory,equipWaiting,multibuy[mbsel]),cancelToolEquip()):levelUp(Gregory,multibuy[mbsel]);else for(i=0;i<=5;i++)if(a!==settings.keybinds["key_craft_"+i]||e.altKey){if(a===settings.keybinds["key_craft_"+i]&&e.altKey){if(Gregory.Hoes[i]<1)return;equipToastID=toast("Equipping Tool","Press a character's upgrade key to equip. Press escape to cancel.","",!0,!1,!1,!0,()=>{cancelToolEquip()},"Cancel"),equipWaiting=i}}else createTool(i,multibuy[mbsel]);a===settings.keybinds.key_cleartoasts?(e.preventDefault(),clearToasts(!1)):a===settings.keybinds.key_tips_menu?openTipsMenu():a===settings.keybinds.key_prestige?openPrestigeMenu():a===settings.keybinds.key_themes?themeSwitcher():a===settings.keybinds.key_cosmetics?cosmeticSwitcher():a===settings.keybinds.key_pane_achievements?panelChange("achievements-panel"):a===settings.keybinds.key_pane_statistics?panelChange("stats-panel"):a===settings.keybinds.key_pane_settings?panelChange("settings-panel"):a===settings.keybinds.key_full_numbers&&((t=dom("full_numbers")).checked=!t.checked,setting("full_numbers",!0))}}}),"");const keyCodes=["ArrowUp ArrowUp ArrowDown ArrowDown ArrowLeft ArrowRight ArrowLeft ArrowRight B A Enter ","G A M I N G ","J J C V I P ","P I N E A P P L E ","H U H W H U H ","C O N F E T T I ","B O R I N G "],keyCodesCode={0:()=>{mouseConfetti([24,24],confettiColors,300)},1:()=>{setTheme("theme_retro"),mouseConfetti([24,24],["gray"],300)},2:()=>{openDialog(...dialog.jjcvip)},3:()=>{setCosmetic("farmable","pineapple")},4:()=>{toast("huh","huh whuh","blue",!0),unlock("cosmetic","huhwhuh","farmable"),setCosmetic("farmable","huhwhuh")},5:()=>{function e(){let e="#";var t=[];for(i=0;i<5;i++){for(ii=0;ii<6;ii++)e+="0123456789abcdef"[r(16)+1];t.push(e),e="#"}mouseConfetti([40,50],t,400)}e(),document.onclick=e},6:()=>{setTheme("theme_dark"),setCosmetic("bundle","default")}};var keyTrigger=[],easterEgg=0;function eggUp(){easterEgg+=easterEgg<101?1:0,mouseConfetti([1,101===easterEgg?2:Math.floor(easterEgg/5)],ccCarrot),100===easterEgg&&mouseConfetti([24,24],confettiColors,300,4,!0)}var equipWaiting=-1,equipToastID=!1;function cancelToolEquip(){equipWaiting=-1,closeToast(equipToastID)}var keyWaitingToast,hashlist,keyWaiting=[!1,"none"];function detectKey(e){keyWaiting=[!0,e],keyWaitingToast=toast("Change keybind",`Press a key for "${e}"`,"",!0,!0,!1,!0,()=>{doneKeybind("none",!1)},"Cancel")}function doneKeybind(e,t=!0){var a=dom(keyWaiting[1]);"Escape"===e&&(e="Not set"),a.blur(),closeToast(keyWaitingToast),t&&(a.innerText=e,t=keyWaiting[1],a=e,console.log(`[Settings] Set ${t} to key: `+a),settings.keybinds[t]=a,saveSettings()),keyWaiting=[!1,"none"]}function interpretKey(e){return" "===e?"Spacebar":capitalizeFL(e)}function evaluateConditions(t){var a=achievements[t];let n=Array.isArray(a.conditions[0]);var s=1,i=0;if(n){if(n){s=a.hasOwnProperty("condition_amount")?a.condition_amount:a.conditions.length;for(let e=0;e<a.conditions.length;e++)o(t,a.conditions[e])}}else o(t,a.conditions);function o(e,t){var a=Function("return "+t[0])();t[1]<=a&&(i++,n&&s<=i||!n)&&grantAchievement(e)}}function rewardBreakdown(e,t=!1){var a=e?.reward;if(void 0!==a)if(Array.isArray(a))for(let e=0;e<a.length;e++)n(a[e],t);else n(a,t);function n(e,t=!1){var a,[n,s]="string"==typeof e||e instanceof String?e.split(":"):["function",e];e&&(!t||"cash"!==n&&"function"!==n&&"character"!==n)&&("theme"===n?unlock(n,s):"cosmetic"===n?([t,a]=s.split("/"),unlock(n,a,t)):"shop"===n?([a,t]=s.split("/"),unlock("shop_item",t,a,e)):"cash"===n?earnCash(parseInt(s),"achievement"):"function"===n?s():"character"===n&&(console.log("Character unlocked: "+s),unlock("character",s)))}}function grantAchievement(e){if(achieveQuery(e))return console.warn(e+" achievement already unlocked");var t=achievements[e];console.log(`Achievement earned: ${t.name} (${e})`),!0!==t.internal&&!0!==t.hide_toast&&!0!==player.flags.no_achievement_toasts&&toast("","","",!1,!1,e),player.achievements[e]=Date.now(),t.internal&&player.internal++,!1!==t.reward&&rewardBreakdown(t),!1!==t.pages&&null!==t.pages&&(player.pages+=t.pages,pagesCount()),achieveHTMLupdate=!0,"achievements-panel"===currentPanel&&populateAchievements(e),updateMainIcon()}function unlock(e,t,a,n){if(isUnlocked(e,t,a))return console.warn(e+`:${a?"/"+a:""}${t} is already unlocked`);if("theme"===e)player.themes.push(t),newIndicator(!0,"theme"),themesHTMLupdate=!0,populateThemeList();else if("cosmetic"===e){if("bundle"===a){console.log("Unlocking a cosmetic bundle! "+a+t);for(let e=0;e<cosmeticsKeys.length;e++){var s=cosmeticsKeys[e];if("bundle"!==s){var i=cosmetics[s];for(let e=0;e<i.keys.length;e++)i[i.keys[e]].group===t&&unlock("cosmetic",i.keys[e],s)}}}player.cosmetics[a].push(t),cosmeticHTMLupdate=!0,populateCosmeticsList(),newIndicator(!0,"cosmetic"),playerCosmeticsCount(),settings.cosmetic_auto_equip&&setCosmetic(a,t)}else if("character"===e){var o=dom(t+"_box");characterQuery(t)||o.classList.add("char_anim"),player.characters[t]=a||!0,o.classList.remove("char_locked"),elBody.classList.add("c_"+t),Object.keys(player.characters).length>=chars.length&&dom("more_chars_tooltip").classList.add("char_locked"),setTimeout(updateAllTools,10)}else if("shop_item"===e){o="cosmetic"===a?n.split("/")[1]+"/"+n.split("/")[2]:t;try{Carl.shop.cosmetic[o].available=!0,console.log(`[Shop] New ${a}: "${o}" now available (Carl)}`)}catch(e){console.warn(e)}settings.carl_shop_toasts&&characterQuery("carl")&&toast("","Carl: A new item is now available","",!1,!0),populateCarl()}else if("trinket"===e)try{Jared.data[t].available=!0,populateJared()}catch(e){console.warn(`[Unlock] Trinket "${t}" doesn't exist`)}}function buyCarl(e,t,a=!1){var n=t;if("c"===e[e.length-1]&&(e="cosmetic",[a,t]=t.split("/")),isUnlocked(e,t,a)||Carl.shop[e][n].bought)return console.warn(e+`:${!1!==a?"/"+a:""}${t} is already unlocked`),toast("Whoops","You already own this","",!1,!0),Carl.shop[e][n].bought=!0,populateCarl();var s=Carl.shop[e][n],i=Default_Carl.shop[e][n];characterQuery("carl")&&s.available&&("cash"===i.currency?player.cash>=i.price?(player.cash-=i.price,Carl.shop[e][n].bought=!0,unlock(e,t,a),cashCount(!1),dom("carl_shop_"+n).classList.add("shop_out"),setTimeout(()=>{populateCarl()},170)):toast("Can't Afford",`Carl wouldn't dare let this piece go for less than ${i.price} coins`,"",!1,!0):toast("other currency","other currencies aren't supported yet"))}function buyTrinket(e){var t,a,n;!0!==characterQuery("jared")||(t=jaredShop[e],a=Jared.data[e],n=t.price[a.level],!a.available)||n>player.cash||"cash"!==t.currency||a.level>=t.price.length||(player.cash-=n,a.level++,a.value=t.value[a.level],player.trinket_completion=function(){let e=jaredShop.keys,t=0,a=0;for(i=0;i<e.length;i++){var n=e[i];t+=Jared?.data[n]?.level,a+=jaredShop[n].price.length}return t+"/"+a}(),populateJared(e),cashCount(!1),mouseConfetti([3,3],ccWhite,150,1),t.update&&t.update())}function characterQuery(e){return player.characters[e]}function allCharQuery(){let e=0;for(i=0;i<chars.length;i++)characterQuery(chars[i])&&e++;return e===chars.length}function achieveQuery(e){return void 0!==player.achievements[e]}function isUnlocked(e="theme",t,a){if("theme"===e&&player.themes.includes(t))return!0;if("cosmetic"===e){if(player.cosmetics[a].includes(t))return!0}else if("shop_item"===e)return carlShopQuery(a,t);return!1}function populateKeybinds(){for(i=0;i<settings.keybinds.keys.length;i++){var e=settings.keybinds.keys[i],t=settings.keybinds[e];null!==dom(e)&&(dom(e).innerHTML=interpretKey(t))}}function resetKeybinds(){settings.keybinds=JSON.parse(JSON.stringify(keybinds_default)),saveSettings(),populateKeybinds(),toast("Settings","Keybinds set to defaults","",!1,!0)}setInterval(()=>{for(let e=0;e<achievementsKeys.length;e++){var t=achievementsKeys[e];achieveQuery(t)||evaluateConditions(t)}},3e3),(()=>{function e(){((hashlist=location.hash.substring(1).split("#")).includes("automute")||hashlist.includes("mute"))&&settingSounds(elEnableSounds.checked=!1),updateMainIcon()}(onhashchange=e)()})(),(()=>{var e,a=[player,player.prestige,player.lifetime,player.cosmetics,settings,settings.cosmetics,settings.keybinds,Boomer_Bill,Belle_Boomerette,Gregory,Charles,Charles.improveWorkingConditions,Charles.decreaseWages,Charles.betterHoes,Carl,Carl.shop,Carl.shop.theme,Carl.shop.cosmetic,Jared,Jared.data],n=[default_player,playerPrestigeTemplate,default_player.lifetime,default_player.cosmetics,default_settings,default_settings.cosmetics,keybinds_default,Default_Boomer_Bill,Default_Belle_Boomerette,Default_Gregory,Default_Charles,Default_Charles.improveWorkingConditions,Default_Charles.decreaseWages,Default_Charles.betterHoes,Default_Carl,Default_Carl.shop,Default_Carl.shop.theme,Default_Carl.shop.cosmetic,Default_Jared,Default_Jared.data];if(default_player.data_version>player.data_version)try{for(oi=0;oi<n.length;oi++){var s=a[oi],o=n[oi],r=Object.keys(o);for(i=0;i<r.length;i++){var l=r[i];s.hasOwnProperty(l)||(console.log(l+" property not found, updating save..."),s[l]=JSON.parse(JSON.stringify(o[l])))}}let t=0;for(let e=0;e<achievementsKeys.length;e++){var c=achievementsKeys[e],u=achievements[c],d=(achieveQuery(c)&&!1!==u.pages&&null!==u.pages&&(t+=u.pages),u.reward);achieveQuery(c)&&!1!==d&&rewardBreakdown(u,!0)}if(player.pages!==t){console.log("Achievement page rewards have been changed");let e=toast("Page Rewards Changed",`The page rewards for completing achievements have been changed. Your Page count has been updated to reflect those changes (${player.pages} -> ${t})`,"orange",!0,!1,!1,!0,()=>{closeToast(e)},"Got it");player.pages=t}player.data_version=default_player.data_version,saveGame()}catch(e){console.warn("An object update was attempted but failed. Error info below:"),console.error(e),toast("Save file update failed","If you run into any issues you may have to delete your save.","error",!0)}for(i=0;i<chars.length;i++){var t=chars[i],p=player.characters[t];characterQuery(t)&&unlock("character",t,p)}achieveCompactMode(settings.compact_achievements),achieveGridMode(settings.achievements_grid),"theme_dark"!==settings.theme&&(e=settings.theme,setTheme(e));for(let e=1;e<cosmeticsKeys.length;e++)"default"!==settings.cosmetics[cosmeticsKeys[e]]&&setCosmetic(cosmeticsKeys[e],settings.cosmetics[cosmeticsKeys[e]]);if(null!==settings.openpanel&&panelChange(settings.openpanel,!0),settings.cosmetics_grid&&(cosmeticsView.value="grid",cosmeticsGridMode()),!1!==Gregory.crafting){console.log("[Greg] Restarting unfinished craft job");try{createTool(...Gregory.crafting)}catch(e){console.error(e)}}settings.show_nav||elBody.classList.add("hide_nav");for(let e=0;e<achievementsKeys.length;e++){var g=achievementsKeys[e],g=achievements[g];g.internal?internalAchievements++:(g.hide_list&&hiddenAchievements++,"challenge"===g.style&&challengeAchievements++)}if("achievements-panel"===currentPanel&&populateAchievements(),!0!==player.flags.cookies_accepted){let e=toast("Cookie Usage","By playing Carrot Clicker you agree to the usage of cookies to save your progress.","purple",!0,!1,!1,!0,()=>{closeToast(e),player.flags.cookies_accepted=!0,saveGame()},"Accept")}!0!==player.flags.tutorial0&&(toast("Welcome to Carrot Clicker!","Click the carrot to farm. Spend your carrots on hiring/upgrading new workers. Eventually you will be able to buy them better tools to work with. Good luck!","",!0),player.flags.tutorial0=!0),populateKeybinds(),fillSettingsPage(),carrotCount(),updateCPC(),cashCount(!1),characterPrices(),characterButtons(),updateCharlesShop(),pagesCount(!1),calculatePrestigePotential(),updateAllTools(),updateToolPrices(),updateMainIcon(),populateCarl(),populateJared(),player.new_theme&&newIndicator(!0,"theme"),player.new_cosmetic&&newIndicator(!0,"cosmetic"),player.prestige_available&&seeButton("prestige"),0<player.lifetime.prestige_count&&showPrestigeStats()})(),loadCheck=!0;